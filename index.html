<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€»ç»Ÿæ¨¡æ‹Ÿå™¨: æƒåŠ›çš„æ¸¸æˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-bg: #16213e;
            --accent-gold: #f1c40f;
            --accent-red: #e74c3c;
            --accent-green: #2ecc71;
            --text-main: #ecf0f1;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            user-select: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- è§’è‰²é€‰æ‹©ç•Œé¢ --- */
        .char-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .char-card {
            background: var(--panel-bg);
            border: 2px solid #34495e;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .char-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-gold);
            box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2);
        }

        .char-card.selected {
            border-color: var(--accent-gold);
            background: #2c3e50;
        }

        .char-icon { font-size: 3rem; margin-bottom: 10px; }
        .skill-tag { background: #e67e22; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; }

        /* --- æ¸¸æˆä¸»ç•Œé¢å¸ƒå±€ --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr 280px; /* å·¦ä¸­å³å¸ƒå±€ */
            gap: 20px;
            height: calc(100vh - 60px);
        }

        /* å·¦ä¾§ï¼šçŠ¶æ€æ  */
        .stats-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-item label { display: block; color: #95a5a6; font-size: 0.9em; margin-bottom: 5px; }
        .stat-value { font-size: 1.8em; font-weight: bold; }
        .progress-bar-bg { background: #333; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .progress-bar-fill { height: 100%; transition: width 0.5s; }

        /* ä¸­é—´ï¼šåŠå…¬æ¡Œ */
        .desk-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .event-banner {
            background: #c0392b;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            animation: fadeInDown 0.5s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cards-area {
            flex-grow: 1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-content: flex-start;
        }

        .game-card {
            width: 200px;
            height: 280px;
            background: #ecf0f1;
            color: #2c3e50;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .game-card:hover { transform: scale(1.05) rotate(1deg); z-index: 10; }
        .card-type { font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; color: #7f8c8d; }
        .card-title { font-size: 1.2em; font-weight: bold; margin: 10px 0; }
        .card-desc { font-size: 0.9em; flex-grow: 1; }
        .card-cost { 
            position: absolute; top: -10px; right: -10px; 
            background: var(--accent-red); color: white; 
            width: 30px; height: 30px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* å³ä¾§ï¼šç»æµä¸æ“ä½œ */
        .action-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .market-trend { 
            font-size: 0.9em; padding: 5px 10px; border-radius: 4px; background: rgba(255,255,255,0.1); text-align: center;
        }

        .invest-btn {
            background: transparent;
            border: 1px solid #555;
            color: #fff;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            border-radius: 6px;
            transition: 0.2s;
            text-align: left;
        }
        .invest-btn:hover:not(:disabled) { background: rgba(255,255,255,0.1); border-color: var(--accent-gold); }
        .invest-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .skill-btn {
            background: linear-gradient(45deg, #f1c40f, #f39c12);
            color: #2c3e50;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #d35400;
        }
        .skill-btn:active { transform: translateY(4px); box-shadow: none; }
        .skill-btn:disabled { filter: grayscale(1); cursor: not-allowed; }

        .next-turn-btn {
            margin-top: auto;
            background: var(--accent-green);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            font-weight: bold;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #fff; color: #333;
            padding: 30px; border-radius: 10px;
            max-width: 500px; text-align: center;
            box-shadow: 0 0 30px rgba(241, 196, 15, 0.5);
        }

        /* å·¥å…·ç±» */
        .text-green { color: var(--accent-green); }
        .text-red { color: var(--accent-red); }
        .log-area { 
            height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); 
            padding: 10px; border-radius: 6px; font-size: 0.85em; font-family: monospace;
            display: flex; flex-direction: column-reverse; /* æ–°æ¶ˆæ¯åœ¨ä¸Šé¢ */
        }
        
        @media (max-width: 900px) {
            .dashboard-grid { grid-template-columns: 1fr; height: auto; }
            .desk-area { order: 2; }
            .action-panel { order: 3; }
            .stats-panel { order: 1; }
        }
    </style>
</head>
<body>

<div id="app" class="container">
    
    <!-- é˜¶æ®µ1: è§’è‰²é€‰æ‹© -->
    <div v-if="state === 'SELECT_CHAR'">
        <h1 style="text-align: center; color: var(--accent-gold);">ğŸ‡ºğŸ‡¸ 2024 æ€»ç»Ÿæ¨¡æ‹Ÿå™¨</h1>
        <p style="text-align: center; color: #bdc3c7;">ç›®æ ‡ï¼šä»»æœŸç»“æŸæ—¶å­˜æ´»ï¼Œå¹¶ç§¯ç´¯ $200 äº¿è´¢å¯Œ</p>
        
        <div class="char-grid">
            <div v-for="char in characters" :key="char.id" 
                 class="char-card" 
                 :class="{ selected: selectedCharId === char.id }"
                 @click="selectedCharId = char.id">
                <div class="char-icon">{{ char.icon }}</div>
                <h3>{{ char.name }}</h3>
                <p style="color: #7f8c8d; font-size: 0.9em;">{{ char.desc }}</p>
                <div style="margin: 10px 0;">
                    <span class="skill-tag">æŠ€èƒ½: {{ char.skillName }}</span>
                </div>
                <p style="font-size: 0.85em;">{{ char.skillDesc }}</p>
                <div style="margin-top: 10px; font-weight: bold;">åˆå§‹èµ„é‡‘: ${{ char.money }}äº¿</div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="next-turn-btn" style="width: 200px;" @click="startGame" :disabled="!selectedCharId">å®£èª“å°±èŒ</button>
        </div>
    </div>

    <!-- é˜¶æ®µ2: æ¸¸æˆä¸»ç•Œé¢ -->
    <div v-if="state === 'PLAYING'" class="dashboard-grid">
        
        <!-- å·¦ä¾§ï¼šæ•°æ®é¢æ¿ -->
        <aside class="stats-panel">
            <h2 style="margin: 0; color: var(--accent-gold);">{{ player.name }}</h2>
            
            <div class="stat-item">
                <label>ä»»æœŸè¿›åº¦ (ç¬¬ {{ month }}/48 æœˆ)</label>
                <div class="progress-bar-bg"><div class="progress-bar-fill" :style="{ width: (month/48)*100 + '%', background: '#3498db' }"></div></div>
            </div>

            <div class="stat-item">
                <label>æ°‘æ„æ”¯æŒç‡ (éœ€ >25%)</label>
                <div class="stat-value" :class="approvalColor">{{ approval }}%</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" :style="{ width: approval + '%', background: approval < 30 ? '#e74c3c' : '#2ecc71' }"></div></div>
            </div>

            <div class="stat-item">
                <label>å®¶æ—è´¢å¯Œ (éœ€ >$1äº¿ / ç›®æ ‡ $200äº¿)</label>
                <div class="stat-value" :class="money < 5 ? 'text-red' : 'text-green'">${{ money.toFixed(2) }}äº¿</div>
            </div>

            <div class="stat-item">
                <label>è¡ŒåŠ¨åŠ› (AP)</label>
                <div style="display: flex; gap: 5px;">
                    <div v-for="n in maxAp" :key="n" 
                         style="width: 20px; height: 20px; border-radius: 50%;"
                         :style="{ background: n <= ap ? '#e67e22' : '#333' }"></div>
                </div>
            </div>

            <div class="log-area">
                <div v-for="(log, i) in logs" :key="i">> {{ log }}</div>
            </div>
        </aside>

        <!-- ä¸­é—´ï¼šæ¡Œé¢ä¸å¡ç‰Œ -->
        <main class="desk-area">
            <!-- çªå‘äº‹ä»¶æ  -->
            <div v-if="currentEvent" class="event-banner animate__animated animate__pulse">
                <span>âš¡ çªå‘æ–°é—»ï¼š</span>
                <strong>{{ currentEvent.title }}</strong>
                <span style="font-size: 0.8em; opacity: 0.8;">{{ currentEvent.desc }}</span>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>å¾…å¤„ç†æ–‡ä»¶ (æ‰‹ç‰Œ)</h3>
                <span style="font-size: 0.8em; color: #95a5a6;">æ”¯æŒç‡å†³å®šä¸‹æœˆAPå›å¤é‡</span>
            </div>

            <div class="cards-area">
                <div v-for="(card, index) in hand" :key="index" class="game-card animate__animated animate__fadeInUp" @click="playCard(index)">
                    <div class="card-cost">{{ card.cost }}</div>
                    <div>
                        <div class="card-type">{{ card.type }}</div>
                        <div class="card-title">{{ card.title }}</div>
                        <div class="card-desc">{{ card.desc }}</div>
                    </div>
                    <div style="font-size: 0.8em; color: #7f8c8d; border-top: 1px solid #bdc3c7; padding-top: 5px;">
                        <div v-if="card.effect.approval">æ”¯æŒç‡: {{ card.effect.approval > 0 ? '+' : ''}}{{ card.effect.approval }}%</div>
                        <div v-if="card.effect.money">è´¢å¯Œ: {{ card.effect.money > 0 ? '+' : ''}}{{ card.effect.money }}äº¿</div>
                    </div>
                </div>
                <div v-if="hand.length === 0" style="width: 100%; text-align: center; color: #7f8c8d; margin-top: 50px;">
                    å½“å‰æ²¡æœ‰å¾…å¤„ç†çš„æ”¿æ²»æ–‡ä»¶ã€‚
                </div>
            </div>
        </main>

        <!-- å³ä¾§ï¼šç»æµæ“ä½œ -->
        <aside class="action-panel">
            <h3 style="margin: 0;">å®¶æ—åŸºé‡‘ä¼š</h3>
            
            <button class="skill-btn" @click="useSkill" :disabled="skillCooldown > 0 || ap < skillCost">
                â˜… ä½¿ç”¨æŠ€èƒ½: {{ player.skillName }}
                <div style="font-size: 0.8em; font-weight: normal; margin-top: 5px;">
                    (æ¶ˆè€—: ${{ player.skillCostMoney || 0 }}äº¿ / {{ skillCost }} AP)
                    <span v-if="skillCooldown > 0">å†·å´: {{ skillCooldown }}æœˆ</span>
                </div>
            </button>

            <div style="border-top: 1px solid #555; margin: 10px 0;"></div>

            <div class="market-trend">
                è‚¡å¸‚è¶‹åŠ¿: <span :style="{color: marketTrend === 'bull' ? '#2ecc71' : '#e74c3c'}">{{ marketTrend === 'bull' ? 'ğŸ“ˆ ç‰›å¸‚' : 'ğŸ“‰ ç†Šå¸‚' }}</span>
                <br>
                åŠ å¯†è´§å¸: <span :style="{color: cryptoTrend === 'bull' ? '#2ecc71' : '#e74c3c'}">{{ cryptoTrend === 'bull' ? 'ğŸš€ æš´æ¶¨' : 'ğŸ©¸ æš´è·Œ' }}</span>
            </div>

            <button class="invest-btn" @click="invest('stock')" :disabled="ap < 1">
                <div>ğŸ¢ <strong>è´­ä¹°è“ç­¹è‚¡</strong> <span style="float: right; color: #e74c3c;">-1 AP</span></div>
                <div style="font-size: 0.8em; color: #bdc3c7; margin-top: 4px;">æˆæœ¬: $1äº¿ | é£é™©: ä½</div>
            </button>

            <button class="invest-btn" @click="invest('crypto')" :disabled="ap < 1">
                <div>ğŸª™ <strong>ç‚’ä½œåŠ å¯†è´§å¸</strong> <span style="float: right; color: #e74c3c;">-1 AP</span></div>
                <div style="font-size: 0.8em; color: #bdc3c7; margin-top: 4px;">æˆæœ¬: $1äº¿ | é£é™©: æé«˜</div>
            </button>

            <button class="invest-btn" @click="embezzle" :disabled="ap < 2">
                <div>ğŸ¤ <strong>æƒåŠ›å¯»ç§Ÿ</strong> <span style="float: right; color: #e74c3c;">-2 AP</span></div>
                <div style="font-size: 0.8em; color: #bdc3c7; margin-top: 4px;">æ¶ˆè€—æ”¯æŒç‡æ¢å–ç°é‡‘</div>
            </button>

            <button class="next-turn-btn" @click="nextTurn">
                {{ month === 48 ? 'å¸ä»»ç»“ç®—' : 'ç»“æŸæœ¬æœˆ' }}
            </button>
        </aside>

    </div>

    <!-- ç»“å±€/è­¦å‘Šæ¨¡æ€æ¡† -->
    <div v-if="modal.show" class="modal-overlay">
        <div class="modal-content animate__animated animate__zoomIn">
            <h2 :style="{color: modal.type === 'win' ? '#2ecc71' : '#e74c3c'}">{{ modal.title }}</h2>
            <p style="font-size: 1.1em; line-height: 1.6;">{{ modal.msg }}</p>
            <button class="next-turn-btn" style="width: 100%; margin-top: 20px;" @click="handleModalAction">{{ modal.btnText }}</button>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    // å®Œæ•´çš„å¡ç‰Œæ•°æ®åº“
    const CARD_DB = [
        { type: "ç»æµ", title: "åŠ å¾å…³ç¨", desc: "ä¿æŠ¤æœ¬åœŸåˆ¶é€ ä¸šï¼Œä½†å•†å“ä»·æ ¼ä¸Šæ¶¨ã€‚", cost: 1, effect: { approval: -5, money: 0.5, economy: 1 } },
        { type: "å†›äº‹", title: "æµ·å¤–ç»´å’Œ", desc: "æ´¾é£å†›é˜Ÿç»´æŠ¤åœ°åŒºç¨³å®šã€‚", cost: 2, effect: { approval: 8, money: -0.5 } },
        { type: "å†…æ”¿", title: "å…¨æ°‘åŒ»ä¿", desc: "å·¨å¤§çš„è´¢æ”¿å¼€æ”¯ï¼Œä½†ç©·äººå–œæ¬¢ã€‚", cost: 2, effect: { approval: 15, money: -2 } },
        { type: "å†…æ”¿", title: "å‡ç¨æ³•æ¡ˆ", desc: "å¯Œè±ªä»¬ä¼šæ„Ÿè°¢ä½ çš„ï¼Œæ°‘ä¼—ä¼šæ„¤æ€’ã€‚", cost: 2, effect: { approval: -10, money: 3 } },
        { type: "å¤–äº¤", title: "é¢†åœŸä¸»å¼ ", desc: "åœ¨äº‰è®®æµ·åŸŸå®£ç¤ºä¸»æƒã€‚", cost: 1, effect: { approval: 5, money: 0 } },
        { type: "é˜´è°‹", title: "æ‰“å‹åª’ä½“", desc: "è®©é‚£äº›æ‰¹è¯„å®¶é—­å˜´ã€‚", cost: 1, effect: { approval: -2, money: 0 } },
        { type: "ç»æµ", title: "ç§‘æŠ€è¡¥è´´", desc: "æŠ•èµ„AIäº§ä¸šï¼Œåˆ©å¥½è‚¡å¸‚ã€‚", cost: 1, effect: { approval: 3, money: 0.2 } },
        { type: "å†…æ”¿", title: "ä¸¥æ‰“çŠ¯ç½ª", desc: "é“è…•æ²»ç†è¡—é“å®‰å…¨ã€‚", cost: 1, effect: { approval: 6, money: -0.2 } },
        { type: "é˜´è°‹", title: "æ”¿æ²»çŒ®é‡‘", desc: "æ¥å—è´¢å›¢çš„'é¦ˆèµ 'ã€‚", cost: 0, effect: { approval: -8, money: 5 } },
        { type: "å†›äº‹", title: "å†›å”®è®¢å•", desc: "å‘ç›Ÿå‹å‡ºå”®æ—§æ­¦å™¨ã€‚", cost: 1, effect: { approval: -3, money: 4 } },
        { type: "å¤–äº¤", title: "æ°”å€™å³°ä¼š", desc: "æ‰¿è¯ºç¢³ä¸­å’Œç›®æ ‡ã€‚", cost: 1, effect: { approval: 4, money: -1 } },
        { type: "ç»æµ", title: "å¤®è¡Œæ”¾æ°´", desc: "å°é’åˆºæ¿€ç»æµã€‚", cost: 2, effect: { approval: 5, money: 1 } }
    ];

    // éšæœºäº‹ä»¶åº“
    const EVENTS_DB = [
        { id: 1, title: "å…¨çƒå¤§æµè¡Œç—…", desc: "åŒ»ç–—ç³»ç»Ÿå´©æºƒï¼Œæ”¯æŒç‡æš´è·Œã€‚", effect: { approval: -10, market: "bear" } },
        { id: 2, title: "ç§‘æŠ€çªç ´", desc: "æœ¬å›½AIæŠ€æœ¯å–å¾—é‡å¤§è¿›å±•ï¼Œè‚¡å¸‚å¤§æ¶¨ã€‚", effect: { approval: 5, market: "bull" } },
        { id: 3, title: "æ¡ƒè‰²ä¸‘é—»", desc: "ä½ çš„ä¸€æ®µå½•éŸ³è¢«æ›å…‰äº†ã€‚", effect: { approval: -15 } },
        { id: 4, title: "å‘ç°å¤§æ²¹ç”°", desc: "å›½å®¶èƒ½æºå‚¨å¤‡å¢åŠ ã€‚", effect: { money: 5, market: "bull" } },
        { id: 5, title: "é‚»å›½æˆ˜äº‰", desc: "å†›ç«å•†è‚¡ç¥¨å¤§æ¶¨ï¼Œåæˆ˜æƒ…ç»ªé«˜æ¶¨ã€‚", effect: { approval: -5, crypto: "bull" } },
    ];

    createApp({
        data() {
            return {
                state: 'SELECT_CHAR', // SELECT_CHAR, PLAYING, GAME_OVER
                selectedCharId: null,
                player: null,
                
                // æ¸¸æˆæ ¸å¿ƒæ•°æ®
                month: 1,
                approval: 50,
                money: 0,
                ap: 2,
                maxAp: 2,
                
                // ç³»ç»ŸçŠ¶æ€
                hand: [],
                logs: [],
                currentEvent: null,
                marketTrend: 'neutral', // bear, neutral, bull
                cryptoTrend: 'bull',
                
                // æŠ€èƒ½çŠ¶æ€
                skillCooldown: 0,
                skillCost: 1, // é»˜è®¤æŠ€èƒ½APæ¶ˆè€—

                // å¼¹çª—
                modal: { show: false, title: '', msg: '', type: 'info', btnText: 'ç¡®å®š' },

                // è§’è‰²å®šä¹‰
                characters: [
                    { 
                        id: 1, name: 'é‡‘å‘å¤§äº¨', icon: 'ğŸ‘±â€â™‚ï¸', 
                        desc: 'å•†ä¸šå¸å›½çš„ç»§æ‰¿äººï¼Œæ“…é•¿æ“çºµåª’ä½“ã€‚', 
                        money: 20, 
                        skillName: 'æ¨ç‰¹æ²»å›½', 
                        skillDesc: 'æ¶ˆè€—$2äº¿ï¼Œéšæœºé‡ç½®å½“å‰æ”¯æŒç‡(30%-80%)ï¼Œå¹¶åˆ·æ–°æ‰€æœ‰æ‰‹ç‰Œã€‚',
                        skillCostMoney: 2
                    },
                    { 
                        id: 2, name: 'èµ„æ·±æ”¿å®¢', icon: 'ğŸ‘´ğŸ»', 
                        desc: 'åœ¨åç››é¡¿æ‘¸çˆ¬æ»šæ‰“40å¹´çš„è€ç‹ç‹¸ã€‚', 
                        money: 5, 
                        skillName: 'æ·±å±‚æ”¿åºœ', 
                        skillDesc: 'æœ¬å›åˆè¡ŒåŠ¨ç‚¹+2ï¼Œä½†åªä¼šæŠ½åˆ°é˜´è°‹/ç»æµç±»å¡ç‰Œã€‚',
                        skillCostMoney: 0
                    },
                    { 
                        id: 3, name: 'ç§‘æŠ€æ–°è´µ', icon: 'ğŸ§‘ğŸ»â€ğŸ’»', 
                        desc: 'äºšè£”ç§‘æŠ€å·¨å¤´ï¼Œç›¸ä¿¡ç®—æ³•èƒ½è§£å†³ä¸€åˆ‡ã€‚', 
                        money: 50, 
                        skillName: 'å†…å¹•äº¤æ˜“', 
                        skillDesc: 'ä¸‹ä¸€æ¬¡æŠ•èµ„å¿…å®šç›ˆåˆ©ï¼Œä¸”æ”¶ç›Šç¿»å€ã€‚',
                        skillCostMoney: 0
                    },
                    { 
                        id: 4, name: 'é€€å½¹å°†å†›', icon: 'ğŸ‘®ğŸ¿â€â™‚ï¸', 
                        desc: 'ä»¥å¼ºç¡¬è‘—ç§°çš„å‰å›½é˜²éƒ¨é•¿ã€‚', 
                        money: 3, 
                        skillName: 'å†›äº‹æˆ’ä¸¥', 
                        skillDesc: 'æ¶ˆè€—20%æ”¯æŒç‡ï¼Œå¼ºåˆ¶é•‡å‹åå¯¹æ´¾ï¼Œä½¿æœ¬æœˆä¸ä¼šè¢«å¼¹åŠ¾ï¼Œä¸”è·å¾—$5äº¿å†›è´¹æŒªç”¨ã€‚',
                        skillCostMoney: 0
                    },
                    { 
                        id: 5, name: 'å¹³æƒæ–—å£«', icon: 'ğŸ‘©ğŸ½', 
                        desc: 'æå…·ç…½åŠ¨åŠ›çš„ç¤¾ä¼šæ´»åŠ¨å®¶ã€‚', 
                        money: 1, 
                        skillName: 'è‰æ ¹ç­¹æ¬¾', 
                        skillDesc: 'å°†å½“å‰æ”¯æŒç‡çš„10%è½¬åŒ–ä¸ºç­‰é¢çš„èµ„é‡‘(äº¿)ã€‚',
                        skillCostMoney: 0
                    },
                    { 
                        id: 6, name: 'å¥½è±åæ˜æ˜Ÿ', icon: 'ğŸ‘©ğŸ¼', 
                        desc: 'å› ä¸ºæ¼”è¿‡æ€»ç»Ÿè€ŒçœŸçš„å½“é€‰äº†æ€»ç»Ÿã€‚', 
                        money: 15, 
                        skillName: 'ç²‰ä¸ç»æµ', 
                        skillDesc: 'æœ¬å›åˆæ‰€æœ‰ç»æµæŠ•èµ„æ— é£é™©ï¼Œä¸”æ”¯æŒç‡+10%ã€‚',
                        skillCostMoney: 1
                    }
                ]
            }
        },
        computed: {
            approvalColor() {
                if (this.approval > 60) return 'text-green';
                if (this.approval < 30) return 'text-red';
                return '';
            }
        },
        methods: {
            startGame() {
                const char = this.characters.find(c => c.id === this.selectedCharId);
                this.player = { ...char }; // æ·±æ‹·è´
                this.money = this.player.money;
                this.state = 'PLAYING';
                this.logs.push(`æ€»ç»Ÿå…ˆç”Ÿ/å¥³å£«ï¼Œæ¬¢è¿å…¥ä¸»ç™½å®«ã€‚å½“å‰æ˜¯ç¬¬1ä¸ªæœˆã€‚`);
                this.drawCards(3);
                this.updateMarketTrends();
            },

            // --- æ ¸å¿ƒå¾ªç¯ ---
            nextTurn() {
                // 1. èƒœåˆ©/å¤±è´¥æ£€æµ‹
                if (this.checkGameOver()) return;

                // 2. æ—¶é—´æ¨è¿›
                this.month++;
                this.addLog(`ğŸ“… è¿›å…¥ç¬¬ ${this.month} ä¸ªæœˆ`);

                // 3. AP å›å¤æœºåˆ¶
                if (this.approval >= 70) this.maxAp = 3;
                else if (this.approval <= 30) this.maxAp = 1;
                else this.maxAp = 2;
                this.ap = this.maxAp;

                // 4. æŠ€èƒ½å†·å´å‡å°‘
                if (this.skillCooldown > 0) this.skillCooldown--;

                // 5. éšæœºäº‹ä»¶è§¦å‘ (20% æ¦‚ç‡)
                this.currentEvent = null;
                if (Math.random() < 0.25) {
                    this.triggerEvent();
                }

                // 6. å¸‚åœºåˆ·æ–°
                this.updateMarketTrends();

                // 7. è¡¥å……å¡ç‰Œ (ä¿æŒæ‰‹ç‰Œ3å¼ )
                const cardsNeeded = 3 - this.hand.length;
                if (cardsNeeded > 0) this.drawCards(cardsNeeded);
            },

            checkGameOver() {
                // è´¢å¯Œ < 1äº¿ -> æš—æ€
                if (this.money < 1) {
                    this.showModal("GAME OVER: é‡åˆºèº«äº¡", "ä½ çš„ç§äººå®‰ä¿å›¢é˜Ÿå› ä¸ºæ¬ è–ªç½¢å·¥äº†ã€‚ä½ åœ¨é«˜å°”å¤«çƒåœºè¢«ä¸æ˜èº«ä»½çš„ç‹™å‡»æ‰‹å‡»æ¯™ã€‚", "fail");
                    return true;
                }
                // æ”¯æŒç‡ < 25 -> å¼¹åŠ¾
                if (this.approval < 25) {
                    this.showModal("GAME OVER: é­åˆ°å¼¹åŠ¾", "å›½ä¼šå…¨ç¥¨é€šè¿‡äº†å¯¹ä½ çš„å¼¹åŠ¾æ¡ˆã€‚ä½ ä¸ä»…ä¸¢äº†å·¥ä½œï¼Œè¿˜å°†é¢ä¸´ç‰¢ç‹±ä¹‹ç¾ã€‚", "fail");
                    return true;
                }
                // 48æœˆç»“æŸ -> ç»“ç®—
                if (this.month > 48) {
                    if (this.money >= 200) {
                        this.showModal("å®Œç¾ç»“å±€: èµ„æœ¬å¤§é³„", `ä»»æœŸç»“æŸã€‚ä½ å¸¦ç€ $${this.money.toFixed(1)}äº¿ çš„å·¨é¢è´¢å¯Œå…‰è£é€€ä¼‘ï¼Œæˆä¸ºå¹•åçœŸæ­£çš„ç»Ÿæ²»è€…ã€‚`, "win");
                    } else {
                        this.showModal("ç»“å±€: å‡„æƒ¨æ™šå¹´", `ä»»æœŸç»“æŸã€‚è™½ç„¶ä½ æ´»äº†ä¸‹æ¥ï¼Œä½†ä»…æœ‰çš„ $${this.money.toFixed(1)}äº¿ è´¢å¯Œä¸è¶³ä»¥è®©ä½ åœ¨æ”¿æ•Œçš„æ¸…ç®—ä¸­è‡ªä¿ã€‚`, "fail");
                    }
                    return true;
                }
                return false;
            },

            // --- è¡Œä¸ºé€»è¾‘ ---
            drawCards(count) {
                for (let i = 0; i < count; i++) {
                    const template = CARD_DB[Math.floor(Math.random() * CARD_DB.length)];
                    this.hand.push({ ...template });
                }
            },

            playCard(index) {
                const card = this.hand[index];
                if (this.ap < card.cost) {
                    this.addLog("âš ï¸ è¡ŒåŠ¨åŠ›ä¸è¶³ï¼");
                    return;
                }

                this.ap -= card.cost;
                this.hand.splice(index, 1);

                // åº”ç”¨æ•ˆæœ
                this.approval += (card.effect.approval || 0);
                this.money += (card.effect.money || 0);
                
                // é™åˆ¶æ•°å€¼èŒƒå›´
                this.approval = Math.min(100, Math.max(0, this.approval));
                this.money = parseFloat(this.money.toFixed(2));

                this.addLog(`ç­¾ç½²æ–‡ä»¶ã€${card.title}ã€‘`);
            },

            invest(type) {
                this.ap -= 1;
                this.money -= 1; // æŠ•å…¥1äº¿
                let roi = 0;

                // ç§‘æŠ€æ–°è´µæŠ€èƒ½ï¼šå¿…èµ¢
                let guaranteedWin = (this.player.id === 3 && this.skillActive);

                if (type === 'stock') {
                    // åŸºç¡€æ³¢åŠ¨ -10% ~ +20%
                    let baseReturn = (Math.random() * 0.3) - 0.1;
                    if (this.marketTrend === 'bull') baseReturn += 0.15; // ç‰›å¸‚åŠ æˆ
                    if (this.marketTrend === 'bear') baseReturn -= 0.15; // ç†Šå¸‚æƒ©ç½š
                    
                    // å¥½è±åæ˜æ˜ŸæŠ€èƒ½ï¼šæ— é£é™©
                    if (this.player.id === 6 && this.skillActive) baseReturn = Math.abs(baseReturn) + 0.1;

                    roi = 1 + baseReturn;
                } else if (type === 'crypto') {
                    // åŸºç¡€æ³¢åŠ¨ -60% ~ +150%
                    let baseReturn = (Math.random() * 2.1) - 0.6;
                    if (this.cryptoTrend === 'bull') baseReturn += 0.5;
                    if (this.cryptoTrend === 'bear') baseReturn -= 0.3;

                    if (guaranteedWin) baseReturn = Math.abs(baseReturn) + 1.0; // æŠ€èƒ½åŠ å€

                    roi = 1 + baseReturn;
                }

                if (guaranteedWin) {
                   this.skillActive = false; // æ¶ˆè€—æŠ€èƒ½çŠ¶æ€
                   this.addLog("âš¡ [è¢«åŠ¨è§¦å‘] å†…å¹•äº¤æ˜“ç”Ÿæ•ˆï¼");
                }
                
                // å¥½è±åæ˜æ˜ŸæŠ€èƒ½çŠ¶æ€æ¶ˆè€—
                if (this.player.id === 6 && this.skillActive) this.skillActive = false;

                const profit = roi - 1;
                this.money += roi;
                this.money = parseFloat(this.money.toFixed(2));
                
                const color = profit > 0 ? 'green' : 'red';
                const icon = profit > 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
                this.addLog(`${icon} æŠ•èµ„ç»“ç®—: ${profit > 0 ? 'ç›ˆåˆ©' : 'äºæŸ'} $${Math.abs(profit).toFixed(2)}äº¿`);
            },

            embezzle() {
                this.ap -= 2;
                this.approval -= 10;
                const gain = 2 + Math.random() * 2; // è·å¾—2-4äº¿
                this.money += gain;
                this.addLog(`ğŸ¤« è¿›è¡Œäº†æƒåŠ›å¯»ç§Ÿï¼Œè·å¾— $${gain.toFixed(1)}äº¿ï¼Œæ”¯æŒç‡ä¸‹é™ã€‚`);
            },

            // --- æŠ€èƒ½ç³»ç»Ÿ ---
            useSkill() {
                if (this.player.skillCostMoney && this.money < this.player.skillCostMoney) {
                    this.addLog("âŒ èµ„é‡‘ä¸è¶³ä»¥å‘åŠ¨æŠ€èƒ½ï¼");
                    return;
                }
                
                this.ap -= this.skillCost;
                this.money -= (this.player.skillCostMoney || 0);
                this.skillCooldown = 6; // 6ä¸ªæœˆå†·å´
                this.addLog(`â˜… å‘åŠ¨æŠ€èƒ½: ${this.player.skillName}`);

                switch(this.player.id) {
                    case 1: // é‡‘å‘å¤§äº¨ï¼šé‡ç½®æ”¯æŒç‡ï¼Œæ¢ç‰Œ
                        this.approval = Math.floor(Math.random() * (80 - 30 + 1)) + 30;
                        this.hand = [];
                        this.drawCards(3);
                        this.addLog("æ¨ç‰¹æ²»å›½ç”Ÿæ•ˆï¼šæ”¯æŒç‡é‡ç½®ï¼Œæ‰‹ç‰Œå·²åˆ·æ–°ã€‚");
                        break;
                    case 2: // èµ„æ·±æ”¿å®¢ï¼šAP+2
                        this.ap += 2;
                        // é€»è¾‘ä¸Šåº”è¯¥æ˜¯ä¸‹æ¬¡æŠ½å¡å˜ç±»å‹ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
                        this.addLog("æ·±å±‚æ”¿åºœè¿ä½œï¼šè·å¾—äº†é¢å¤–çš„è¡ŒåŠ¨åŠ›ã€‚");
                        break;
                    case 3: // ç§‘æŠ€æ–°è´µï¼šçŠ¶æ€æ ‡è®°
                        this.skillActive = true; 
                        this.addLog("å†…å¹•æ¶ˆæ¯å·²è·å–ï¼šä¸‹æ¬¡æŠ•èµ„å¿…å®šå¤§èµšã€‚");
                        break;
                    case 4: // é€€å½¹å°†å†›ï¼šå†›è´¹æŒªç”¨
                        this.approval -= 20;
                        this.money += 5;
                        this.addLog("æˆ’ä¸¥ä»¤ç”Ÿæ•ˆï¼šæ”¯æŒç‡æš´è·Œï¼Œä½†å†›è´¹å·²å…¥è´¦ã€‚");
                        break;
                    case 5: // å¹³æƒæ–—å£«ï¼šæ”¯æŒç‡æ¢é’±
                        const convert = this.approval * 0.1;
                        this.money += convert;
                        this.approval -= 10;
                        this.addLog(`è‰æ ¹ç­¹æ¬¾ï¼šè·å¾—äº† $${convert.toFixed(1)}äº¿ ææ¬¾ã€‚`);
                        break;
                    case 6: // å¥½è±åæ˜æ˜Ÿ
                        this.approval += 10;
                        this.skillActive = true;
                        this.addLog("ç²‰ä¸ç‹‚çƒ­ï¼šæ”¯æŒç‡ä¸Šå‡ï¼Œæœ¬å›åˆæŠ•èµ„æ— é£é™©ã€‚");
                        break;
                }
            },

            // --- è¾…åŠ©ç³»ç»Ÿ ---
            triggerEvent() {
                const event = EVENTS_DB[Math.floor(Math.random() * EVENTS_DB.length)];
                this.currentEvent = event;
                this.addLog(`âš¡ çªå‘: ${event.title}`);
                
                if (event.effect.approval) this.approval += event.effect.approval;
                if (event.effect.money) this.money += event.effect.money;
                if (event.effect.market) this.marketTrend = event.effect.market;
                if (event.effect.crypto) this.cryptoTrend = event.effect.crypto;
            },

            updateMarketTrends() {
                // ç®€å•é©¬å°”å¯å¤«é“¾
                const states = ['bear', 'neutral', 'bull'];
                // 30% æ¦‚ç‡å˜åŠ¨è¶‹åŠ¿
                if (Math.random() < 0.3) {
                    this.marketTrend = states[Math.floor(Math.random() * 3)];
                }
                if (Math.random() < 0.4) {
                    this.cryptoTrend = states[Math.floor(Math.random() * 3)];
                }
            },

            addLog(msg) {
                this.logs.push(msg);
                // ä¿æŒæ—¥å¿—ä¸è¿‡é•¿
                if(this.logs.length > 20) this.logs.shift();
            },

            showModal(title, msg, type) {
                this.modal = {
                    show: true,
                    title: title,
                    msg: msg,
                    type: type, // 'win', 'fail', 'info'
                    btnText: (type === 'win' || type === 'fail') ? 'é‡æ–°å¼€å§‹' : 'ç¡®å®š'
                };
            },

            handleModalAction() {
                if (this.modal.type === 'win' || this.modal.type === 'fail') {
                    location.reload();
                } else {
                    this.modal.show = false;
                }
            }
        }
    }).mount('#app');
</script>
</body>
</html>